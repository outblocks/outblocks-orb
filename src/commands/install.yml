description: Install Outblocks CLI.

parameters:
  version:
    type: string
    default: "0.1.38"
    description: Version of the CLI to install.

steps:
  - run:
      name: Install Outblocks CLI version, if not available
      command: |
        install () {
          # Set sudo to work whether logged in as root user or non-root user
          if [[ $EUID == 0 ]]; then export SUDO=""; else export SUDO="sudo"; fi
          cd ~/
          curl -Ss --retry 5 https://github.com/outblocks/outblocks-cli/releases/download/v<<parameters.version>>/outblocks-<<parameters.version>>-linux_amd64.tar.gz | tar xz
          mv ok /usr/local/bin/
          echo 'ok bash completion' >> $BASH_ENV
        }

        if [[ $(command -v ok) == "" ]]; then
          install
        else
          echo "outblocks CLI is already installed."
        fi
  - run:
      name: outblocks CLI version
      command: ok version
